#!/usr/bin/env python3
import ast
import pathlib
import sys

def get_imports_from_file(file_path):
    """Parses a Python file and returns a set of top-level module names."""
    imports = set()
    try:
        with open(file_path, "r", encoding="utf-8") as f:
            tree = ast.parse(f.read(), filename=file_path)
        
        for node in ast.walk(tree):
            if isinstance(node, ast.Import):
                for n in node.names:
                    imports.add(n.name.split('.')[0])
            elif isinstance(node, ast.ImportFrom):
                if node.level == 0 and node.module:  # Exclude relative imports
                    imports.add(node.module.split('.')[0])
    except (SyntaxError, UnicodeDecodeError):
        # Skip files that aren't valid Python or have encoding issues
        pass
    return imports

import ast
import pathlib
import sys

# ... [keep the get_imports_from_file function from previous response] ...

def main():
    current_dir = pathlib.Path(".")
    output_file = current_dir / "importz.txt"
    all_imports = set()
    
    for py_file in current_dir.rglob("*.py"):
        all_imports.update(get_imports_from_file(py_file))
    
    std_libs = getattr(sys, "stdlib_module_names", set())
    local_modules = {p.stem for p in current_dir.glob("*.py")}
    local_packages = {p.name for p in current_dir.iterdir() if p.is_dir() and (p / "__init__.py").exists()}

    third_party = sorted([
        ".".join(imp) if isinstance(imp, list) else imp 
        for imp in all_imports 
        if (imp[0] if isinstance(imp, list) else imp) not in std_libs 
        and (imp[0] if isinstance(imp, list) else imp) not in local_modules 
        and (imp[0] if isinstance(imp, list) else imp) not in local_packages
        and imp != "__future__"
    ])

    # Save to importz.txt
    if third_party:
        output_file.write_text("\n".join(third_party), encoding="utf-8")
        print(f"Saved {len(third_party)} imports to {output_file}")
    else:
        print("No 3rd-party imports found.")

if __name__ == "__main__":
    main()

