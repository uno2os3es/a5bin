#!/data/data/com.termux/files/usr/bin/env python3
import sys
import os

def remove_unprintable_chars(input_file):
    # Create a backup file
    backup_file = input_file + '.bak'
    os.replace(input_file, backup_file)

    # Read the backup file and filter unprintable characters
    with open(backup_file, 'rb') as f_in, open(input_file, 'wb') as f_out:
        for line in f_in:
            # Decode as 'latin-1' to avoid UnicodeDecodeError,
            # then filter out unprintable chars (except \n, \r, \t)
            decoded_line = line.decode('latin-1')
            filtered_line = ''.join(
                char for char in decoded_line if char in ('\n', '\r', '\t') or char.isprintable()
            )
            f_out.write(filtered_line.encode('utf-8'))


if __name__ == '__main__':
    if len(sys.argv) != 2:
        print('Usage: python script.py <input_file>')
        sys.exit(1)

    input_file = sys.argv[1]
    if not os.path.exists(input_file):
        print(f"Error: File '{input_file}' not found.")
        sys.exit(1)

    remove_unprintable_chars(input_file)
    print(f"File '{input_file}' cleaned. Backup created as '{input_file}.bak'")
import os
import shutil
import string

#!/usr/bin/env python3
import sys


def find_unprintable_positions(text):
    allowed = set(string.printable) | {'\n', '\r', '\t'}
    positions = []  # list of (line, column, char, code)

    line_num = 1
    col_num = 1
    for ch in text:
        if ch not in allowed:
            positions.append((line_num, col_num, ch, ord(ch)))
        if ch == '\n':
            line_num += 1
            col_num = 1
        else:
            col_num += 1
    return positions


def clean_text(text):
    allowed = set(string.printable) | {'\n', '\r', '\t'}
    return ''.join(ch for ch in text if ch in allowed)


def clean_file(path: str) -> None:
    backup_path = path + '.bak'
    shutil.copy2(path, backup_path)

    with open(path, 'r', encoding='utf-8', errors='ignore') as f:
        data = f.read()

    positions = find_unprintable_positions(data)
    if positions:
        print(f'Found {len(positions)} unprintable character(s):')
        for line, col, ch, code in positions:
            # Show hex code for clarity
            print(f'  Line {line}, Col {col}: char code {code} (0x{code:02X})')
    else:
        print('No unprintable characters found.')

    cleaned = clean_text(data)
    with open(path, 'w', encoding='utf-8', errors='ignore') as f:
        f.write(cleaned)


def main():
    if len(sys.argv) != 2:
        print(f'Usage: {os.path.basename(sys.argv[0])} <filename>')
        sys.exit(1)

    fname = sys.argv[1]
    if not os.path.isfile(fname):
        print(f"Error: '{fname}' is not a file")
        sys.exit(1)

    clean_file(fname)


if __name__ == '__main__':
    main()
